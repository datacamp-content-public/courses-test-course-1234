---
title: Insert title here
key: a1287233264d054055594fd273e393e9

---
## GROUP BY

```yaml
type: "TitleSlide"
key: "ebaa099c66"
```

`@lower_third`

name: Irene Ortner
title: Data Scientist at KU Leuven and Applied Statistics


`@script`
Now we add some more complexity to our queries by using the GROUP BY clause. For evaluating the success and potential of MovieNow - our online movie renal company - it is desirable to look at groups of customers or groups of products jointly. We could be interested to group customers – for example by country or gender - or we could group movies by genre or year of release. Let’s have a look at an example.


---
## Table: MoviesSub

```yaml
type: "FullImageSlide"
key: "a0a4f83884"
```

`@part1`
![](image-url)


`@script`
Here we extracted a subset of the Movies table from the data base for illustration. We call this table MoviesSub to avoid confusion with the Movies table.

We have the movies’ names, its genres and the prices for renting the movie for 24 hours. Now we are interested in the average price of renting a movie for each genre. 

To do this we will use the GROUP BY statement. Let’s start step by step.


---
## Average rental price

```yaml
type: "TwoColumns"
key: "f3c257f96f"
```

`@part1`
```
SELECT Genre
FROM MoviesSub
GROUP BY Genre
```
{{0}}



_include figure of results_
{{1}}


`@part2`
```
SELECT Genre, AVG(Price)
FROM MoviesSub
GROUP BY Genre
```
{{2}}

_include figure of results_
{{3}}


`@script`
We select the genre form the table MoviesSub and group it by genre.

This query gives us a list of distinct genres. By itself this is nothing else than use the SELECT DISTINCT statment, but with the group by statment we can add now aggregation functions to the SELECT statement. For our example we are interested in the average price per genre, so we ad AVG of price in the SELECT statement.

The idea here is to apply the average function to subgroups of tuples in the table, where each subgroup consists of movie tuples that have the same genre. 
Note that the result table in a GROUP BY query will have as many rows as distinct values in the grouping variable.

To understand better what this query does, let’s go back to the table MoviesSub.


---
## MovieSub table

```yaml
type: "FullImageSlide"
key: "129cbd5ba1"
```

`@part1`



`@script`
We can think of a group by statement as a split into subgroups. The colors of the tuples in the table visualize the genres. The GROUP BY Genre clause makes groups based upon the genre ...


---
## MovieSub table split

```yaml
type: "FullImageSlide"
key: "deb68bf8a8"
```

`@part1`



`@script`
...as you can see here - every group in separate tables. We have a group for the genre Fantasy, Drama and so on. Then we can apply any aggregation functions to each of the sub-tables. In the previous query we calculated the average price for each group. Now, we can additionally use COUNT to get the number of movies in each sub-table, for example 3 for Fantasy and 4 for drama.


---
## Average rental price and number of movies

```yaml
type: "FullCodeSlide"
key: "1e1c04f049"
```

`@part1`
```
SELECT Genre, AVG(Price), COUNT(*)
FROM MoviesSub
GROUP BY Genre
```


`@script`
This is the query extended by the number of movies in each category.

We have used COUNT with a star before to count all tuples in a query. Now we use it to count the tuples in each subgroup separately, that means we count the number of movies for each genre.


---
## Final Slide

```yaml
type: "FinalSlide"
key: "561d9273fe"
```

`@script`
Ok, now it’s your turn to use GROUP BY statements.

